{"status":{},"spec":{"description":"","resources":{"client_attrs":{"475ef8f3_deployment":{"y":-146.9111006778,"x":121.7498661769},"7fd4467f-d9ca-4518-45a3-8361e9593f2b":{"y":-146.9111006778,"x":121.7498661769}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e2f5e268_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7e63b2f6_runbook","main_task_local_reference":{"kind":"app_task","name":"e2f5e268_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"12750efa_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9401dc4d_runbook","main_task_local_reference":{"kind":"app_task","name":"12750efa_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"f1f7c768_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7cd1acbb_runbook","main_task_local_reference":{"kind":"app_task","name":"f1f7c768_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0bbc117e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2512b8c1_runbook","main_task_local_reference":{"kind":"app_task","name":"0bbc117e_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"073eb51f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"444dc194_runbook","main_task_local_reference":{"kind":"app_task","name":"073eb51f_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"W2k12 IIS","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"IIS Application X","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"SysprepCreds"}},"editables":{"create_spec":{"name":true,"resources":{"nic_list":{"0":{"ip_endpoint_list":{"0":{"ip":true}},"subnet_reference":true}},"serial_port_list":{},"disk_list":{}}}},"os_type":"Windows","create_spec":{"name":"@@{MachineName}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[{"ip":"@@{MachineIP}@@","type":"ASSIGNED"}],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"6d49152e-7697-4c7a-9ae4-60def98282cb"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n    <settings pass=\"oobeSystem\">\n        <component name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <InputLocale>0413:00020409<\/InputLocale>\n            <SystemLocale>en-US<\/SystemLocale>\n            <UILanguageFallback>en-US<\/UILanguageFallback>\n            <UserLocale>nl-NL<\/UserLocale>\n        <\/component>\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <AutoLogon>\n                <Enabled>true<\/Enabled>\n                <LogonCount>9999999<\/LogonCount>\n                <Username>Administrator<\/Username>\n                <Password>\n                    <PlainText>true<\/PlainText>\n                    <Value>@@{SysprepCreds.secret}@@<\/Value>\n                <\/Password>\n            <\/AutoLogon>\n            <OOBE>\n                <HideEULAPage>true<\/HideEULAPage>\n                <HideWirelessSetupInOOBE>true<\/HideWirelessSetupInOOBE>\n                <NetworkLocation>Home<\/NetworkLocation>\n                <ProtectYourPC>2<\/ProtectYourPC>\n            <\/OOBE>\n            <UserAccounts>\n                <AdministratorPassword>\n                    <PlainText>true<\/PlainText>\n                    <Value>@@{SysprepCreds.secret}@@<\/Value>\n                <\/AdministratorPassword>\n            <\/UserAccounts>\n            <FirstLogonCommands>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c winrm quickconfig -q<\/CommandLine>\n                    <Description>Win RM quickconfig -q<\/Description>\n                    <Order>20<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c winrm quickconfig -transport:http<\/CommandLine>\n                    <Description>Win RM quickconfig -transport:http<\/Description>\n                    <Order>21<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c winrm set winrm\/config @{MaxTimeoutms=\"1800000\"}<\/CommandLine>\n                    <Description>Win RM MaxTimoutms<\/Description>\n                    <Order>22<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c winrm set winrm\/config\/winrs @{MaxMemoryPerShellMB=\"300\"}<\/CommandLine>\n                    <Description>Win RM MaxMemoryPerShellMB<\/Description>\n                    <Order>23<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c winrm set winrm\/config\/service @{AllowUnencrypted=\"true\"}<\/CommandLine>\n                    <Description>Win RM AllowUnencrypted<\/Description>\n                    <Order>24<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c winrm set winrm\/config\/service\/auth @{Basic=\"true\"}<\/CommandLine>\n                    <Description>Win RM auth Basic<\/Description>\n                    <Order>25<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c winrm set winrm\/config\/client\/auth @{Basic=\"true\"}<\/CommandLine>\n                    <Description>Win RM auth Basic<\/Description>\n                    <Order>26<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c winrm set winrm\/config\/listener?Address=*+Transport=HTTP @{Port=\"5985\"} <\/CommandLine>\n                    <Description>Win RM listener Address\/Port<\/Description>\n                    <Order>27<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c netsh advfirewall firewall set rule group=\"remote administration\" new enable=yes <\/CommandLine>\n                    <Description>Win RM adv firewall enable<\/Description>\n                    <Order>29<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c net stop winrm <\/CommandLine>\n                    <Description>Stop Win RM Service <\/Description>\n                    <Order>28<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>cmd.exe \/c net start winrm <\/CommandLine>\n                    <Description>Start Win RM Service<\/Description>\n                    <Order>32<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <CommandLine>powershell -Command &quot;Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Force&quot;<\/CommandLine>\n                    <Description>Set PowerShell ExecutionPolicy<\/Description>\n                    <Order>1<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>2<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <CommandLine>powershell -Command &quot;Enable-PSRemoting -Force&quot;<\/CommandLine>\n                    <Description>Enable PowerShell Remoting<\/Description>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>5<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <Description>RDP adv firewall enable<\/Description>\n                    <CommandLine>cmd.exe \/c netsh advfirewall firewall set rule group=&quot;Remote Desktop&quot; new enable=yes <\/CommandLine>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>31<\/Order>\n                    <CommandLine>cmd.exe \/c sc config winrm start= auto<\/CommandLine>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <Description>No-Delay Auto start WinRM on boot<\/Description>\n                <\/SynchronousCommand>\n                <SynchronousCommand wcm:action=\"add\">\n                    <Order>30<\/Order>\n                    <RequiresUserInput>true<\/RequiresUserInput>\n                    <CommandLine>cmd.exe \/c netsh advfirewall set allprofiles state off<\/CommandLine>\n                    <Description>Disable Windows Firewall<\/Description>\n                <\/SynchronousCommand>\n            <\/FirstLogonCommands>\n<ShowWindowsLive>false<\/ShowWindowsLive>\n        <\/component>\n    <\/settings>\n    <settings pass=\"specialize\">\n        <component name=\"Microsoft-Windows-Deployment\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <RunSynchronous>\n                <RunSynchronousCommand wcm:action=\"add\">\n                    <Order>1<\/Order>\n                    <Path>net user administrator \/active:Yes<\/Path>\n                    <WillReboot>Never<\/WillReboot>\n                <\/RunSynchronousCommand>\n            <\/RunSynchronous>\n        <\/component>\n        <component name=\"Microsoft-Windows-Security-SPP-UX\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <SkipAutoActivation>true<\/SkipAutoActivation>\n        <\/component>\n        <component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <ComputerName>*<\/ComputerName>\n        <\/component>\n    <\/settings>\n    <settings pass=\"windowsPE\">\n        <component name=\"Microsoft-Windows-International-Core-WinPE\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\">\n            <SetupUILanguage>\n            <UILanguage>en-US <\/UILanguage>\n            <\/SetupUILanguage>\n            <InputLocale>en-US <\/InputLocale>\n            <SystemLocale>en-US <\/SystemLocale>\n            <UILanguage>en-US <\/UILanguage>\n            <UILanguageFallback>en-US <\/UILanguageFallback>\n            <UserLocale>en-US <\/UserLocale>\n        <\/component>\n    <\/settings>\n<\/unattend>","type":""}},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"Windows 2012","uuid":"794b520b-908f-45ee-8650-d51316406a3b"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":{"Environment":"Production","AppFamily":"DevOps"}},"variable_list":[]}],"credential_definition_list":[{"username":"administrator","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"SysprepCreds","editables":{"secret":true}},{"username":"administrator","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"DomainCreds","editables":{"secret":true}}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"W2k12 IIS"}],"name":"Join Domain","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Join Domain"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Rename and Join Domain"},{"kind":"app_task","name":"Wait for Reboot"},{"kind":"app_task","name":"Install IIS"},{"kind":"app_task","name":"Wait for Install"},{"kind":"app_task","name":"Create Website"},{"kind":"app_task","name":"Inject Config"},{"kind":"app_task","name":"Add Website to Loadbalancer"}],"name":"5baea253_dag","state":"NOT_VALIDATED","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Rename and Join Domain"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Wait for Reboot"}},{"from_task_reference":{"kind":"app_task","name":"Wait for Reboot"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install IIS"}},{"from_task_reference":{"kind":"app_task","name":"Install IIS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Wait for Install"}},{"from_task_reference":{"kind":"app_task","name":"Wait for Install"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Website"}},{"from_task_reference":{"kind":"app_task","name":"Create Website"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Inject Config"}},{"from_task_reference":{"kind":"app_task","name":"Inject Config"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Add Website to Loadbalancer"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Rename and Join Domain","state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"\n$DomainUsername = \"@@{DomainCreds.username}@@\"\n$DomainPassword = \"@@{DomainCreds.secret}@@\"\n$MachineName = \"@@{MachineName}@@\"\n$domainname = \"@@{DomainFQDN}@@\"\n\n$Securepass = ConvertTo-SecureString -asPlainText -Force -String $DomainPassword\n$credential = New-Object System.Management.Automation.PSCredential(\"$($DomainName)\\$($DomainUsername)\",$Securepass)\n\ntry {\n  Rename-Computer -NewName $MachineName\n  $restart = 1\n} catch {\n  write-host \"Rename computer failed.\"\n}\ntry {\n  write-host \"Joining machine to $domainname using \"\n  Add-computer -DomainName $DomainName -Credential $credential -force -Options JoinWithNewName,AccountCreate\n  $restart = 1\n} catch {\n  if ((Get-WmiObject -Class Win32_ComputerSystem).PartOfDomain){\n    write-host \"Machine is already part of the domain.\"\n  } else {\n    write-host \"Error joining machine to the domain. Machine is not joined.\"\n  }\n}\nif ($restart -eq 1){\n  shutdown -r -t 20 -f\n}\n\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"SysprepCreds"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Wait for Reboot","state":"NOT_VALIDATED","attrs":{"type":"","interval_secs":60},"timeout_secs":"0","type":"DELAY","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install IIS","state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"Enable-WindowsOptionalFeature -Online -FeatureName IIS-WebServerRole\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-WebServer\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-CommonHttpFeatures\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-HttpErrors\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-HttpRedirect\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-ApplicationDevelopment\nEnable-WindowsOptionalFeature -online -FeatureName NetFx4Extended-ASPNET45\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-NetFxExtensibility45\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-HealthAndDiagnostics\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-HttpLogging\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-LoggingLibraries\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-RequestMonitor\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-HttpTracing\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-Security\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-RequestFiltering\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-Performance\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-WebServerManagementTools\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-IIS6ManagementCompatibility\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-Metabase\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-ManagementConsole\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-BasicAuthentication\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-WindowsAuthentication\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-StaticContent\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-DefaultDocument\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-WebSockets\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-ApplicationInit\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-ISAPIExtensions\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-ISAPIFilter\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-HttpCompressionStatic\nEnable-WindowsOptionalFeature -Online -FeatureName IIS-ASPNET45","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DomainCreds"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Wait for Install","state":"NOT_VALIDATED","attrs":{"type":"","interval_secs":60},"timeout_secs":"0","type":"DELAY","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Create Website","state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"$appname = \"@@{IISAppName}@@\"\n$fqdn = \"@@{IISwwwFQDN}@@\"\nImport-Module WebAdministration\n\ncd iis:\\apppools\nNew-WebAppPool -name \"$($appname)-AppPool\" -force\n$appPool = Get-Item \"$($appname)-AppPool\" \n$appPool.processModel.identityType = \"NetworkService\"\n$appPool.enable32BitAppOnWin64 = 1\n$appPool | Set-Item\nmd \"c:\\Web Sites\\$($appname)\"\n\n$site = new-WebSite -name \"$($appname)\" -PhysicalPath \"c:\\Web Sites\\$($appname)\" -HostHeader \"$($fqdn)\" -ApplicationPool \"$($appname)-AppPool\" -force","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DomainCreds"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Inject Config","state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"## Stage 2 of the demo not now","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DomainCreds"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Add Website to Loadbalancer","state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"### Step 2 of the demo for later ","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DomainCreds"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"9ef6a1b8_runbook","state":"NOT_VALIDATED","main_task_local_reference":{"kind":"app_task","name":"5baea253_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Join Domain"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove from Domain"},{"kind":"app_task","name":"Wait for reboot"}],"name":"15e4948c_dag","state":"NOT_VALIDATED","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Remove from Domain"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Wait for reboot"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Remove from Domain","state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"\n$DomainUsername = \"@@{DomainCreds.username}@@\"\n$DomainPassword = \"@@{DomainCreds.secret}@@\"\n$domainname @@{DomainFQDN}@@\"\n$Securepass = ConvertTo-SecureString -asPlainText -Force -String $DomainPassword\n$credential = New-Object System.Management.Automation.PSCredential(\"$($DomainName)\\$($DomainUsername)\",$Securepass)\nRemove-computer -UnjoinDomaincredential $credential -PassThru -Verbose -Force\nshutdown -r -t 30 -f","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DomainCreds"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"W2k12 IIS"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Wait for reboot","state":"NOT_VALIDATED","attrs":{"type":"","interval_secs":60},"timeout_secs":"0","type":"DELAY","variable_list":[]}],"description":"","name":"ff4b5aeb_runbook","state":"NOT_VALIDATED","main_task_local_reference":{"kind":"app_task","name":"15e4948c_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"475ef8f3_deployment","published_service_local_reference_list":[],"max_replicas":"8","package_local_reference_list":[{"kind":"app_package","name":"Join Domain"}],"substrate_local_reference":{"kind":"app_substrate","name":"IIS Application X"},"min_replicas":"1","variable_list":[],"description":""}],"description":"","action_list":[],"name":"IIS","variable_list":[{"val_type":"STRING","description":"","name":"IIS_LB_IP","type":"LOCAL","value":"123","label":"","editables":{"value":true}},{"val_type":"STRING","description":"","name":"DomainFQDN","type":"LOCAL","value":"123","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"MachineName","type":"LOCAL","value":"IIS-index","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"IISAppName","type":"LOCAL","value":"123","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"IISwwwFQDN","type":"LOCAL","value":"123","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"MachineIP","type":"LOCAL","value":"123","label":"","attrs":{"type":""},"editables":{"value":true}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"SysprepCreds"},"type":"USER"},"name":"IIS Customer Horizontal Scale"},"api_version":"3.0","metadata":{"last_update_time":"1549805362912576","kind":"blueprint","spec_version":44,"creation_time":"1549794280110918","name":"IIS Customer Horizontal Scale"}}